<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Advanced Photo Maker - Preview</title>
<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background: #121212;
        color: #e0e0e0;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        overflow-x: hidden;
    }

    /* General Styling */
    h1, h2, h3 {
        color: #ffffff;
    }

    button, input[type="file"], select, input[type="text"], input[type="number"], input[type="color"] {
        /* Reset and Base Styles */
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border: none;
        outline: none;
        padding: 12px 20px;
        margin: 5px;
        background: #282828;
        color: #e0e0e0;
        border-radius: 50px; /* Circular for buttons, rounded for others */
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    button:hover, input[type="file"]::-webkit-file-upload-button:hover, select:hover {
        background: #3a3a3a;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }

    /* Input Specifics */
    input[type="text"], input[type="number"] {
        border-radius: 12px;
        width: 200px;
        padding: 12px 15px;
        background: #1e1e1e;
        border: 1px solid #333;
        color: #ffffff;
    }

    input[type="file"] {
        padding: 0;
        background: none;
        width: auto;
    }
    input[type="file"]::-webkit-file-upload-button {
        background: #282828;
        color: #e0e0e0;
        border-radius: 50px;
        padding: 12px 20px;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    input[type="file"]::-webkit-file-upload-button:hover {
        background: #3a3a3a;
    }

    /* Color Input (special case) */
    input[type="color"] {
        padding: 5px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #3a3a3a;
        background: none;
    }
    input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
    }
    input[type="color"]::-webkit-color-swatch {
        border: none;
        border-radius: 50%;
    }

    select {
        padding: 12px 15px;
        background: #282828 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="5" viewBox="0 0 10 5"><path fill="%23e0e0e0" d="M0 0l5 5 5-5z"/></svg>') no-repeat right 15px center;
        background-size: 10px 5px;
        border-radius: 12px;
    }

    /* Container Specifics */
    #toolbar {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 10px;
        background: #1e1e1e;
        padding: 15px;
        border-radius: 20px;
        margin: 20px 0;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        max-width: 90%;
    }
    #toolbar label {
        color: #b0b0b0;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    canvas {
        border: 2px solid #333;
        background: #1e1e1e;
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        max-width: 100%;
        height: auto;
    }

    .canvas-container-wrapper {
        padding: 20px;
        background: #1a1a1a;
        border-radius: 25px;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        margin: 20px;
        display: flex;
        justify-content: center;
    }

    .photo-maker-app {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    #project-name-display {
        font-size: 2em;
        margin-top: 20px;
        color: #e0e0e0;
        text-align: center;
        max-width: 90%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* Responsive Design */
    @media (max-width: 900px) {
        #toolbar {
            flex-direction: row;
            flex-wrap: wrap;
            padding: 10px;
            gap: 8px;
        }
        button, select, input[type="text"], input[type="number"] {
            padding: 10px 15px;
            font-size: 14px;
        }
    }
    @media (max-width: 600px) {
        body {
            justify-content: flex-start;
        }
        #toolbar {
            flex-direction: column;
            width: 90%;
        }
        #toolbar > * {
            width: 90%;
            text-align: center;
            box-sizing: border-box;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
        }
        .canvas-container-wrapper {
            padding: 10px;
        }
    }
</style>
</head>
<body>

<div class="photo-maker-app">
    <h1 id="project-name-display">Advanced Photo Maker - Preview</h1>
    <div id="toolbar">
        <label>Brush: <input type="color" id="brushColor" value="#ff0000"></label>
        <input type="number" id="brushSize" value="5" min="1" max="50">
        <button onclick="toggleDrawing()">‚úèÔ∏è Draw</button>
        <input type="file" id="addImage" accept="image/*">
        <input type="text" id="textInput" placeholder="Add Text...">
        <label>Color: <input type="color" id="textColor" value="#ffffff"></label>
        <input type="number" id="textSize" value="30">
        <select id="textFont">
            <option>Arial</option>
            <option>Comic Sans MS</option>
            <option>Courier New</option>
            <option>Georgia</option>
            <option>Times New Roman</option>
        </select>
        <button onclick="addText()">üî§ Text</button>
        <select id="shapeSelect">
            <option value="">Shape...</option>
            <option value="rect">Rectangle</option>
            <option value="circle">Circle</option>
            <option value="triangle">Triangle</option>
        </select>
        <button onclick="addShape()">‚¨ú Shape</button>
        <select id="stickerSelect">
            <option value="">Sticker...</option>
            <option value="https://i.imgur.com/4AiXzf8.png">Star</option>
            <option value="https://i.imgur.com/3X3QZpM.png">Heart</option>
            <option value="https://i.imgur.com/Oj1N0TQ.png">Smiley</option>
        </select>
        <button onclick="addSticker()">üíñ Sticker</button>
        <select id="filterSelect">
            <option value="">Filter...</option>
            <option value="grayscale">Grayscale</option>
            <option value="sepia">Sepia</option>
            <option value="invert">Invert</option>
            <option value="brightness">Brightness +0.2</option>
        </select>
        <button onclick="applyFilter()">üé® Filter</button>
        <button onclick="bringForward()">‚¨ÜÔ∏è Front</button>
        <button onclick="sendBackward()">‚¨áÔ∏è Back</button>
        <button onclick="undo()">‚Ü©Ô∏è Undo</button>
        <button onclick="redo()">‚Ü™Ô∏è Redo</button>
        <button onclick="deleteObject()">üóëÔ∏è Delete</button>
        <button onclick="savePhoto()">üñºÔ∏è Download</button>
    </div>
    <div class="canvas-container-wrapper">
        <canvas id="canvas" width="800" height="600"></canvas>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<script>
    let canvas;
    let state = [];
    let currentStateIndex = -1;

    document.addEventListener('DOMContentLoaded', () => {
        canvas = new fabric.Canvas('canvas', { backgroundColor: 'transparent', isDrawingMode: false });
        initializeCanvasFunctions();
    });

    function saveState() {
        if (currentStateIndex < state.length - 1) {
            state = state.slice(0, currentStateIndex + 1);
        }
        state.push(JSON.stringify(canvas));
        currentStateIndex++;
    }

    function initializeCanvasFunctions() {
        canvas.on('object:added', saveState);
        canvas.on('object:modified', saveState);
        canvas.on('object:removed', saveState);

        document.getElementById('brushColor').oninput = e => canvas.freeDrawingBrush.color = e.target.value;
        document.getElementById('brushSize').oninput = e => canvas.freeDrawingBrush.width = parseInt(e.target.value, 10);
        canvas.freeDrawingBrush = new fabric.PencilBrush(canvas);
    }
    
    window.undo = function() {
        if (currentStateIndex > 0) {
            currentStateIndex--;
            canvas.loadFromJSON(state[currentStateIndex], () => canvas.renderAll());
        }
    };

    window.redo = function() {
        if (currentStateIndex < state.length - 1) {
            currentStateIndex++;
            canvas.loadFromJSON(state[currentStateIndex], () => canvas.renderAll());
        }
    };

    window.deleteObject = function() {
        const activeObjects = canvas.getActiveObjects();
        if (activeObjects.length > 0) {
            activeObjects.forEach(obj => canvas.remove(obj));
            canvas.discardActiveObject().renderAll();
            saveState();
        }
    };

    window.savePhoto = function() {
        const dataURL = canvas.toDataURL({
            format: 'png',
            quality: 1.0
        });
        const link = document.createElement('a');
        link.href = dataURL;
        link.download = 'photo-maker-preview.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };

    window.toggleDrawing = function() {
        canvas.isDrawingMode = !canvas.isDrawingMode;
        alert(`Drawing mode is now ${canvas.isDrawingMode ? 'ON' : 'OFF'}.`);
    };

    document.getElementById('addImage').onchange = function(e) {
        const reader = new FileReader();
        reader.onload = function(f) {
            fabric.Image.fromURL(f.target.result, function(img) {
                img.scaleToWidth(200);
                canvas.add(img).centerObject(img).setActiveObject(img);
            });
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    window.addText = function() {
        const textVal = document.getElementById('textInput').value;
        if (!textVal) return;
        const text = new fabric.Textbox(textVal, {
            fill: document.getElementById('textColor').value,
            fontSize: parseInt(document.getElementById('textSize').value),
            fontFamily: document.getElementById('textFont').value,
            left: 100,
            top: 100
        });
        canvas.add(text).setActiveObject(text);
    };

    window.addShape = function() {
        const type = document.getElementById('shapeSelect').value;
        let shape;
        if (type === 'rect') {
            shape = new fabric.Rect({ width: 100, height: 60, fill: 'red', left: 150, top: 150 });
        } else if (type === 'circle') {
            shape = new fabric.Circle({ radius: 50, fill: 'green', left: 150, top: 150 });
        } else if (type === 'triangle') {
            shape = new fabric.Triangle({ width: 100, height: 100, fill: 'blue', left: 150, top: 150 });
        }
        if (shape) canvas.add(shape).setActiveObject(shape);
    };

    window.addSticker = function() {
        const url = document.getElementById('stickerSelect').value;
        if (!url) return;
        fabric.Image.fromURL(url, function(img) {
            img.scaleToWidth(100);
            canvas.add(img).centerObject(img).setActiveObject(img);
        });
    };

    window.applyFilter = function() {
        const filter = document.getElementById('filterSelect').value;
        const obj = canvas.getActiveObject();
        if (!obj || obj.type !== 'image') return alert('Select an image to apply a filter.');

        switch(filter) {
            case 'grayscale':
                obj.filters.push(new fabric.Image.filters.Grayscale());
                break;
            case 'sepia':
                obj.filters.push(new fabric.Image.filters.Sepia());
                break;
            case 'invert':
                obj.filters.push(new fabric.Image.filters.Invert());
                break;
            case 'brightness':
                obj.filters.push(new fabric.Image.filters.Brightness({ brightness: 0.2 }));
                break;
        }
        obj.applyFilters();
        canvas.renderAll();
    };

    window.bringForward = function() {
        const obj = canvas.getActiveObject();
        if (obj) canvas.bringForward(obj);
    };

    window.sendBackward = function() {
        const obj = canvas.getActiveObject();
        if (obj) canvas.sendBackwards(obj);
    };
</script>
</body>
</html>
